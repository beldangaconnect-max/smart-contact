<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Desi Battle Royale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;overflow:hidden;}
canvas{background:#2e7d32;display:block;margin:auto;}

.controls{position:fixed;bottom:20px;left:20px;}
.btn{
  width:50px;height:50px;
  background:rgba(255,255,255,0.3);
  border-radius:10px;margin:5px;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;
}
.fire{
  position:fixed;
  bottom:40px;
  right:20px;
  background:red;
  color:#fff;
}
.restart{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#1976d2;
  color:#fff;
  padding:14px 30px;
  border-radius:12px;
  font-size:18px;
  z-index:10;
  display:none;
}
</style>
</head>

<body>

<canvas id="game" width="360" height="640"></canvas>

<div class="controls">
  <div class="btn" ontouchstart="move.up=true" ontouchend="move.up=false">â¬†</div>
  <div style="display:flex">
    <div class="btn" ontouchstart="move.left=true" ontouchend="move.left=false">â¬…</div>
    <div class="btn" ontouchstart="move.right=true" ontouchend="move.right=false">âž¡</div>
  </div>
  <div class="btn" ontouchstart="move.down=true" ontouchend="move.down=false">â¬‡</div>
</div>

<div class="btn fire" ontouchstart="shoot()">ðŸ”¥</div>
<div class="restart" id="restartBtn" ontouchstart="restartGame()">RESTART</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

/* VARIABLES */
let player, move, bullets, enemies, loots, zone;
let gameOver=false, winner=false, kills=0;
let difficulty=1, gameTime=0;

/* INIT */
function init(){
  player={
    x:canvas.width/2-15,
    y:canvas.height/2-15,
    size:30,
    speed:3,
    dir:"up",
    health:100
  };

  move={up:false,down:false,left:false,right:false};
  bullets=[];
  enemies=[];
  loots=[];
  kills=0;
  gameOver=false;
  winner=false;
  difficulty=1;
  gameTime=0;

  zone={
    x:canvas.width/2,
    y:canvas.height/2,
    radius:200,
    shrink:0.05
  };

  document.getElementById("restartBtn").style.display="none";
}
init();

/* KEYBOARD */
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp"){move.up=true;player.dir="up";}
  if(e.key==="ArrowDown"){move.down=true;player.dir="down";}
  if(e.key==="ArrowLeft"){move.left=true;player.dir="left";}
  if(e.key==="ArrowRight"){move.right=true;player.dir="right";}
  if(e.key===" "){shoot();}
});
document.addEventListener("keyup",e=>{
  if(e.key==="ArrowUp")move.up=false;
  if(e.key==="ArrowDown")move.down=false;
  if(e.key==="ArrowLeft")move.left=false;
  if(e.key==="ArrowRight")move.right=false;
});

/* SHOOT */
function shoot(){
  if(gameOver||winner) return;
  bullets.push({
    x:player.x+player.size/2,
    y:player.y+player.size/2,
    dir:player.dir,
    speed:6
  });
}

/* ENEMY SPAWN */
setInterval(()=>{
  if(!gameOver && !winner){
    for(let i=0;i<difficulty;i++){
      enemies.push({
        x:Math.random()*(canvas.width-30),
        y:Math.random()*(canvas.height-30),
        size:30,
        speed:Math.min(1+difficulty*0.25,3)
      });
    }
  }
},2500);

/* LOOT SPAWN */
setInterval(()=>{
  if(!gameOver && !winner){
    loots.push({
      x:Math.random()*(canvas.width-20),
      y:Math.random()*(canvas.height-20),
      size:20,
      heal:20
    });
  }
},5000);

/* UPDATE */
function update(){
  if(gameOver||winner) return;

  gameTime++;
  if(gameTime%600===0) difficulty++;

  if(move.up)player.y-=player.speed;
  if(move.down)player.y+=player.speed;
  if(move.left)player.x-=player.speed;
  if(move.right)player.x+=player.speed;

  player.x=Math.max(0,Math.min(canvas.width-player.size,player.x));
  player.y=Math.max(0,Math.min(canvas.height-player.size,player.y));

  bullets.forEach((b,bi)=>{
    if(b.dir==="up")b.y-=b.speed;
    if(b.dir==="down")b.y+=b.speed;
    if(b.dir==="left")b.x-=b.speed;
    if(b.dir==="right")b.x+=b.speed;

    if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height){
      bullets.splice(bi,1);
    }
  });

  enemies.forEach(e=>{
    if(player.x<e.x)e.x-=e.speed;
    if(player.x>e.x)e.x+=e.speed;
    if(player.y<e.y)e.y-=e.speed;
    if(player.y>e.y)e.y+=e.speed;

    if(
      player.x<e.x+e.size &&
      player.x+player.size>e.x &&
      player.y<e.y+e.size &&
      player.y+player.size>e.y
    ){
      player.health-=0.35;
    }
  });

  bullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(
        b.x>e.x&&b.x<e.x+e.size &&
        b.y>e.y&&b.y<e.y+e.size
      ){
        enemies.splice(ei,1);
        bullets.splice(bi,1);
        kills++;
      }
    });
  });

  loots.forEach((l,li)=>{
    if(
      player.x<l.x+l.size &&
      player.x+player.size>l.x &&
      player.y<l.y+l.size &&
      player.y+player.size>l.y
    ){
      player.health+=l.heal;
      if(player.health>100)player.health=100;
      loots.splice(li,1);
    }
  });

  zone.radius-=zone.shrink;
  if(zone.radius<60)zone.radius=60;

  const dx=(player.x+15)-zone.x;
  const dy=(player.y+15)-zone.y;
  if(Math.sqrt(dx*dx+dy*dy)>zone.radius){
    player.health-=0.2+difficulty*0.05;
  }

  if(player.health<=0){
    gameOver=true;
    document.getElementById("restartBtn").style.display="block";
  }

  if(kills>=15){
    winner=true;
    document.getElementById("restartBtn").style.display="block";
  }

  if(enemies.length>25) enemies.splice(0,enemies.length-25);
  if(loots.length>8) loots.splice(0,loots.length-8);
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.beginPath();
  ctx.arc(zone.x,zone.y,zone.radius,0,Math.PI*2);
  ctx.strokeStyle="rgba(0,120,255,0.7)";
  ctx.lineWidth=3;
  ctx.stroke();

  ctx.fillStyle="yellow";
  ctx.fillRect(player.x,player.y,player.size,player.size);

  ctx.fillStyle="#111";
  bullets.forEach(b=>ctx.fillRect(b.x-3,b.y-3,6,6));

  ctx.fillStyle="red";
  enemies.forEach(e=>ctx.fillRect(e.x,e.y,e.size,e.size));

  ctx.fillStyle="cyan";
  loots.forEach(l=>ctx.fillRect(l.x,l.y,l.size,l.size));

  ctx.fillStyle="rgba(0,0,0,0.6)";
  ctx.fillRect(5,5,160,60);

  ctx.fillStyle="red";
  ctx.fillRect(10,15,140,10);
  ctx.fillStyle="lime";
  ctx.fillRect(10,15,Math.max(0,player.health)*1.4,10);

  ctx.fillStyle="white";
  ctx.font="14px Arial";
  ctx.fillText("KILLS: "+kills,10,45);

  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,0.75)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="white";
    ctx.font="30px Arial";
    ctx.fillText("GAME OVER",70,320);
  }

  if(winner){
    ctx.fillStyle="rgba(0,0,0,0.75)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="gold";
    ctx.font="30px Arial";
    ctx.fillText("WINNER!",110,320);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

function restartGame(){
  init();
}
</script>

</body>
</html>
